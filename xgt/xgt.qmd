---
title: "Render table to Word"
format: html
editor: visual
---

# xgt()
## Descriptive tables
```{r}
set_jgt_theme()
mtcars %>% select(mpg, cyl, disp) %>% xgt() 

mtcars %>% select(mpg, cyl, disp, vs, carb) %>% xgt(., order.cat = TRUE) 

mtcars %>% select(mpg, cyl, disp, vs, carb) %>% xgt(., force.continuous  = TRUE) 

mtcars %>% select(mpg, cyl, disp, vs) %>% 
  xgt(., by = "vs", overall = TRUE, overall.last = TRUE, add.p = TRUE, percent = "row", 
      spanner.text = "Not sure what 'vs' is", add.n = FALSE, digit.cont = 2, digit.cat = c(0, 3))
```

## Publication quality tables
```{r}
set_pgt_theme()
mtcars %>% select(hp, drat, wt, vs, am, cyl) %>% 
  mutate(wt_over3 = ifelse(wt > 3, "wt >3", "wt <= 3")) %>% 
  mutate(vs = yesno(vs), am = yesno(am)) %>% 
  inline_label(hp = "Horse power",
               wt_over3 = "Weight categorized",
               vs = "VS",
               am = "AM") %>% 
  recat() %>% xgt(., defaults = "pgt", by = "cyl")

```


## Exporting tables with pubble

```{r}
pubble <- function(tbl_list, output, open = TRUE) {
  stopifnot(is.list(tbl_list))
  stopifnot(length(output) == 1)

  library(gt)
  library(purrr)

  # Convert each element to gt, apply header if named
  grouped <- imap(tbl_list, ~ {
    tbl <- .x
    # handle gtsummary
    if (inherits(tbl, "gtsummary")) {
      tbl <- as_gt(tbl)
    }
    # ensure it's gt now
    if (!inherits(tbl, "gt_tbl")) {
      stop("All elements must be gt or gtsummary tables")
    }
    if (!is.null(.y) && .y != "") {
      tbl <- tab_header(tbl, title = .y)
    }
    tbl
  })

  # combine into one grouped gt
  combined <- exec(gt_group, !!!grouped)

  # save to chosen format
  gtsave(combined, filename = output)

  # optionally open file
  if (open) {
    if (.Platform$OS.type == "windows") {
      shell.exec(output)
    } else if (Sys.info()[["sysname"]] == "Darwin") {
      system2("open", output)
    } else {
      system2("xdg-open", output)
    }
  }

  invisible(output)
}


mytables %>% unname() %>% 
pubble(., output = "tables.html")
```

